<!--
Name: Ruby Bron
Studenid: 12474223
Data source: http://projects.knmi.nl/klimatologie/daggegevens/selectie.cgi
This file creates a line chart from a json datafile

I would like to use the one time only wild card for this exercise
-->
<!DOCTYPE html>
<html>
	<head>
		<title>Line Chart Creator</title>
	</head>
	<body>
		<canvas id="line-graph" width="750" height="400"></canvas>
		<script>
			var fileName = "data.json";
			var txtFile = new XMLHttpRequest();
			txtFile.onreadystatechange = function() {
    		if (txtFile.readyState === 4 && txtFile.status == 200) {
        		var json = JSON.parse(txtFile.responseText);
        		reformatData(json);
    			}
			}
			txtFile.open("GET", fileName);
			txtFile.send();

			var temp = [];
			var domain = [];
			var range = [350, 100];
			var yScreen;
			var yRange = [];

			function reformatData(json) {
				// reformats data for graph
				Object.keys(json).forEach(function(element) {
					temp.push(json[element]["TG"]);
				})
				console.log(temp);
				domain.push(Math.min(...temp));
				domain.push(Math.max(...temp));
				console.log(domain);

				yScreen = createTransform(domain, range)
				yLine = [yScreen(-150), yScreen(-100), yScreen(-50), yScreen(0), yScreen(50), yScreen(100), yScreen(150), yScreen(200), yScreen(250), yScreen(300),]

				Object.keys(json).forEach(function(element) {
					yRange.push(yScreen(json[element]["TG"]))
				})

				createDataLines(yRange, json)
				createLines(yLine)
			}

			// this finds the alpha and beta
			function createTransform(domain, range) {
			// domain is a two-element array of the data bounds [domain_min, domain_max]
			// range is a two-element array of the screen bounds [range_min, range_max]
			// this gives you two equations to solve:
			// range_min = alpha * domain_min + beta
			// range_max = alpha * domain_max + beta
			// a solution would be:

			var domain_min = domain[0]
			var domain_max = domain[1]
			var range_min = range[0]
			var range_max = range[1]

			// formulas to calculate the alpha and the beta
			var alpha = (range_max - range_min) / (domain_max - domain_min)
			var beta = range_max - alpha * domain_max

			// returns the function for the linear transformation (y= a * x + b)
			return function(x){
				return alpha * x + beta;
				}
			}

			function createDataLines(y, json) {
				ctx.beginPath();
				ctx.strokeStyle = 'green';

				datapoints = 366;
				console.log(y);
				xRange = [];
				counter = 0;
				Object.keys(json).forEach(function(element) {
					xRange.push(counter*1.85+50);
					counter++;
					})

				ctx.moveTo(xRange[0], y[0])
				for (var i = 0; i < datapoints; i++) {
					ctx.lineTo(xRange[i], y[i])
					console.log(xRange[i], y[i])
				}
				ctx.stroke();
			}

			// structure for drawing in canvas
			const canvas = document.getElementById("line-graph");
			const ctx = canvas.getContext("2d");

			// square in which the graph will be drawn
			ctx.strokeRect(0, 50, 750, 350);

			//title of graph in personalised font
			ctx.font = '26px sans-serif'
			ctx.fillText("Average temperature in 0.1\xB0C Berkhout, the Netherlands (2018)", 0, 40);

			function createLines(y) {
				//makes lines starting from 0 
				ctx.beginPath();
				ctx.strokeStyle = 'grey';
				ctx.font = '15px sans-serif'

				var x1 = 25;
				var x2 = 725;
				var space = 50;
				var lines1 = 10;
				var yTemp = -15;
				for(var i = 0; i < lines1; i++) {
					ctx.moveTo(x1, y[i]);
					ctx.lineTo(x2, y[i]);
					ctx.fillText(yTemp, 10, y[i])
					yTemp = yTemp + 5;
				}
				ctx.moveTo(25, 100);
				ctx.stroke();	
			}
		</script>
	</body>
</html>